{% extends "base.html" %}
{% load static %}

{% block title %}Todos — List{% endblock %}

{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 m-0">To‑Dos</h1>
    <a class="btn btn-primary" href="{% url 'todos:create' %}">New To‑Do</a>
  </div>

  <ul class="nav nav-pills mb-3">
    {% with current=status|default:'open' %}
      <li class="nav-item">
        <a class="nav-link {% if current == 'open' %}active{% endif %}" href="?status=open">Open</a>
      </li>
      <li class="nav-item">
        <a class="nav-link {% if current == 'completed' %}active{% endif %}" href="?status=completed">Completed</a>
      </li>
      <li class="nav-item">
        <a class="nav-link {% if current == 'all' %}active{% endif %}" href="?status=all">All</a>
      </li>
    {% endwith %}
  </ul>

  {% if todos %}
    <div class="list-group">
      {% for todo in todos %}
        <div class="list-group-item d-flex justify-content-between align-items-center">
          <div class="me-3">
            <div class="fw-semibold {% if todo.completed %}text-decoration-line-through text-muted{% endif %}">
              {{ todo.title }}
            </div>
            {% if todo.due_date %}
              <small class="text-muted">Due: {{ todo.due_date }}</small>
            {% endif %}
          </div>
          <div class="btn-group" role="group">
            <form method="post" action="{% url 'todos:toggle_complete' todo.pk %}{% if status %}?status={{ status }}{% endif %}">
              {% csrf_token %}
              {% if todo.completed %}
                <button type="submit" class="btn btn-sm btn-outline-secondary">Mark Open</button>
              {% else %}
                <button type="submit" class="btn btn-sm btn-outline-success">Mark Done</button>
              {% endif %}
            </form>
            <a class="btn btn-sm btn-outline-primary" href="{% url 'todos:edit' todo.pk %}">Edit</a>
            <a class="btn btn-sm btn-outline-danger" href="{% url 'todos:delete' todo.pk %}">Delete</a>
          </div>
        </div>
      {% endfor %}
    </div>

    {% if is_paginated %}
      <nav aria-label="Pagination" class="mt-3">
        <ul class="pagination mb-0">
          {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if status %}&status={{ status }}{% endif %}">Previous</a>
            </li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">Previous</span></li>
          {% endif %}

          <li class="page-item disabled"><span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span></li>

          {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if status %}&status={{ status }}{% endif %}">Next</a>
            </li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">Next</span></li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}
  {% else %}
    <div class="alert alert-info">No to‑dos found. Create your first one!</div>
  {% endif %}
{% endblock %}
